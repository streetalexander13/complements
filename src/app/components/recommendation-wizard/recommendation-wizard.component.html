<div class="chatbot-wizard">
  <!-- Progress Bar -->
  <div class="progress-container">
    <div class="progress-content">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="getProgressPercentage()"></div>
      </div>
      <div class="progress-text">
        <span class="question-counter">{{ currentQuestion + 1 }} of {{ totalQuestions }}</span>
      </div>
    </div>
  </div>

  <!-- Chat Interface -->
  <div class="chat-container">
    <div class="chat-messages" #chatContainer>
      
      <!-- Chat History -->
      <div *ngFor="let message of chatMessages; let i = index" class="message" 
           [class.bot-message]="message.type === 'bot'" 
           [class.user-message]="message.type === 'user'">
        
        <!-- Bot Message -->
        <div *ngIf="message.type === 'bot'" class="message-avatar">
          <div class="avatar-circle">
            <span class="material-icons">psychology</span>
          </div>
        </div>
        
        <div class="message-content">
          <div class="message-text" 
               [class.typing-animation]="i === chatMessages.length - 1 && message.type === 'bot' && !isThinking">
            {{ message.content }}
          </div>
        </div>
        
        <!-- User Message -->
        <div *ngIf="message.type === 'user'" class="message-avatar">
          <div class="avatar-circle user">
            <span class="material-icons">person</span>
          </div>
        </div>
      </div>

      <!-- Thinking Animation -->
      <div *ngIf="isThinking" class="message bot-message">
        <div class="message-avatar">
          <div class="avatar-circle">
            <span class="material-icons">psychology</span>
          </div>
        </div>
        <div class="message-content">
          <div class="thinking-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>

    </div>

    <!-- Question Input Area -->
    <div *ngIf="!isThinking && !showReview" class="question-input">
      <div class="input-container">
        
        <!-- Text Input -->
        <div *ngIf="getCurrentQuestion()?.type === 'text'" class="input-group">
          <input 
            type="text" 
            [(ngModel)]="textInput"
            [placeholder]="getCurrentQuestion()?.placeholder"
            class="text-input"
            (keyup.enter)="submitTextAnswer()">
          <button 
            class="send-btn"
            (click)="submitTextAnswer()"
            [disabled]="!textInput">
            <span class="material-icons">send</span>
          </button>
        </div>

        <!-- Number Input -->
        <div *ngIf="getCurrentQuestion()?.type === 'number'" class="input-group">
          <input 
            type="number" 
            [(ngModel)]="numberInput"
            [placeholder]="getCurrentQuestion()?.placeholder"
            class="text-input"
            (keyup.enter)="submitNumberAnswer()">
          <button 
            class="send-btn"
            (click)="submitNumberAnswer()"
            [disabled]="!numberInput">
            <span class="material-icons">send</span>
          </button>
        </div>

        <!-- Radio Options -->
        <div *ngIf="getCurrentQuestion()?.type === 'radio'" class="radio-options">
          <button 
            *ngFor="let option of getCurrentQuestion()?.options" 
            class="option-btn"
            (click)="answerQuestion(option.value)">
            {{ option.label }}
          </button>
        </div>

        <!-- Sports Selection -->
        <div *ngIf="getCurrentQuestion()?.type === 'sports'" class="sports-selection">
          <div class="sport-options">
            <button 
              *ngFor="let sport of getAllSports(); let i = index" 
              class="sport-btn"
              [class.selected]="isSportSelected(sport.value)"
              (click)="answerQuestion(sport.value)"
              [style.animation-delay.ms]="i * 100">
              <span class="sport-icon material-icons">{{ sport.icon }}</span>
              <span class="sport-label">{{ sport.label }}</span>
            </button>
          </div>
          <button 
            class="continue-btn"
            (click)="nextQuestion()"
            [disabled]="!isQuestionAnswered('sports')">
            Continue
          </button>
        </div>

        <!-- Goals Selection -->
        <div *ngIf="getCurrentQuestion()?.type === 'goals'" class="goals-selection">
          <div class="goal-ranking-container">
            <div class="goal-section">
              <h4>Available Goals</h4>
              <div class="goal-list available-goals">
                <button 
                  *ngFor="let goal of availableGoals" 
                  class="goal-btn"
                  (click)="addGoalToRanked(goal)">
                  <span class="goal-label">{{ formatGoalLabel(goal) }}</span>
                  <span class="material-icons">add</span>
                </button>
              </div>
            </div>

            <div class="goal-section">
              <h4>Your Priority Order</h4>
              <div class="goal-list ranked-goals">
                <div 
                  *ngFor="let goal of rankedGoals; let i = index" 
                  class="goal-item ranked-goal">
                  <div class="goal-content">
                    <span class="rank-number">{{ i + 1 }}</span>
                    <span class="goal-label">{{ formatGoalLabel(goal) }}</span>
                    <button 
                      type="button" 
                      class="remove-goal"
                      (click)="removeGoal(goal)">
                      <span class="material-icons">close</span>
                    </button>
                  </div>
                </div>
                <div *ngIf="rankedGoals.length === 0" class="empty-state">
                  <p>Tap goals to add them here</p>
                </div>
              </div>
            </div>
          </div>
          <button 
            class="continue-btn"
            (click)="nextQuestion()"
            [disabled]="!isQuestionAnswered('goals')">
            Continue
          </button>
        </div>

        <!-- Fitness Level Selection -->
        <div *ngIf="getCurrentQuestion()?.type === 'fitnessLevel'" class="fitness-level-selection">
          <div class="level-grid">
            <button 
              *ngFor="let level of ['beginner', 'intermediate', 'advanced']" 
              class="level-btn"
              [class.selected]="wizardForm.get('fitnessLevel')?.value === level"
              (click)="answerQuestion(level)">
              <div class="level-card">
                <h3>{{ getLevelTitle(level) }}</h3>
                <p>{{ getLevelDescription(level) }}</p>
                
                <!-- Show personalized supplements -->
                <div class="level-supplements">
                  <div *ngFor="let supplement of getPersonalizedSupplementsForLevel(level, buildUserProfile())" 
                       class="supplement-preview">
                    <span class="supplement-name">{{ supplement.name }}</span>
                    <span class="supplement-price">Â£{{ supplement.price }}</span>
                  </div>
                </div>
                
                <div class="level-price">{{ getLevelPrice(level) }}</div>
              </div>
            </button>
          </div>
        </div>

        <!-- Textarea Input -->
        <div *ngIf="getCurrentQuestion()?.type === 'textarea'" class="input-group">
          <textarea 
            [(ngModel)]="textareaInput"
            [placeholder]="getCurrentQuestion()?.placeholder"
            class="textarea-input"
            rows="4"></textarea>
          <button 
            class="send-btn"
            (click)="submitTextareaAnswer()">
            <span class="material-icons">send</span>
          </button>
        </div>

      </div>
    </div>

    <!-- Review Section -->
    <div *ngIf="showReview" class="review-section">
      <div class="message bot-message">
        <div class="message-avatar">
          <div class="avatar-circle">
            <span class="material-icons">psychology</span>
          </div>
        </div>
        <div class="message-content">
          <div class="message-text">
            Perfect! Here's what I've put together for you
          </div>
        </div>
      </div>

      <!-- Box Preview -->
      <div class="box-preview">
        <div class="box-header">
          <h3>{{ getUserName() }}'s Box</h3>
          <div class="box-level">{{ getSelectedLevel() }}</div>
        </div>
        
        <div class="box-contents">
          <div class="content-section">
            <h4>Equipment</h4>
            <div class="benefit-list">
              <div class="benefit-item">
                <span class="benefit-icon">YOGA</span>
                <div class="benefit-content">
                  <h5>Foam Roller</h5>
                  <p>Recovery after training sessions</p>
                </div>
              </div>
              <div class="benefit-item">
                <span class="benefit-icon">CLIMB</span>
                <div class="benefit-content">
                  <h5>Yoga Mat</h5>
                  <p>Flexibility and mobility work</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="content-section">
            <h4>Supplements</h4>
            <div class="benefit-list">
              <div class="benefit-item">
                <span class="benefit-icon">STRENGTH</span>
                <div class="benefit-content">
                  <h5>Protein ({{ getDietType() }} blend)</h5>
                  <p><strong>5-15% faster muscle recovery</strong></p>
                </div>
              </div>
              <div class="benefit-item">
                <span class="benefit-icon material-icons">accessibility</span>
                <div class="benefit-content">
                  <h5>Vitamin D3 + K2</h5>
                  <p><strong>23% stronger bones</strong></p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="box-price">
          <span class="price-label">Monthly subscription</span>
          <span class="price-amount">{{ getBoxPrice() }}</span>
        </div>
      </div>

      <button 
        class="subscribe-btn"
        (click)="subscribeToBox()"
        [disabled]="isLoading">
        <span *ngIf="!isLoading">Let's do this!</span>
        <span *ngIf="isLoading">Setting up your box...</span>
      </button>
    </div>

    <!-- Navigation -->
    <div *ngIf="!isThinking && !showReview" class="chat-navigation">
      <button 
        *ngIf="currentQuestion > 0"
        type="button" 
        class="nav-btn back-btn"
        (click)="previousQuestion()">
        <span class="material-icons">arrow_back</span>
        Back
      </button>
    </div>
  </div>
</div>